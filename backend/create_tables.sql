-- Securinets-Quiz: Oracle SQL Table Definitions
CREATE TABLE Users (
    userID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) UNIQUE NOT NULL,
    password VARCHAR2(512) NOT NULL,
    phone VARCHAR2(20),
    role VARCHAR2(20) CHECK (role IN ('member', 'admin', 'banned')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Quiz (
    quizID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR2(100) NOT NULL,
    description VARCHAR2(500),
    timelimit NUMBER, -- in minutes
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE UserQuiz (
    userQuizID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    userID NUMBER REFERENCES Users(userID) ON DELETE CASCADE,
    quizID NUMBER REFERENCES Quiz(quizID) ON DELETE CASCADE,
    score NUMBER,
    passed CHAR(1) CHECK (passed IN ('Y', 'N')),
    taken_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE Questions (
    questionID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    quizID NUMBER REFERENCES Quiz(quizID) ON DELETE CASCADE,
    title VARCHAR2(200) NOT NULL,
    category VARCHAR2(50),
    difficulty VARCHAR2(20),
    points NUMBER,
    description VARCHAR2(500)
);


CREATE TABLE Answers (
    answerID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    questionID NUMBER REFERENCES Questions(questionID) ON DELETE CASCADE,
    answer_text VARCHAR2(500) NOT NULL,
    is_correct CHAR(1) CHECK (is_correct IN ('Y', 'N'))
);


CREATE TABLE Submissions (
    subID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    userID NUMBER REFERENCES Users(userID) ON DELETE CASCADE,
    questionID NUMBER REFERENCES Questions(questionID) ON DELETE CASCADE,
    iscorrect CHAR(1) CHECK (iscorrect IN ('Y', 'N'))
);

CREATE TABLE AdminLog (
    logID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    action VARCHAR2(100) NOT NULL,
    reason VARCHAR2(500),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

select * FROM USERS;
select * from ADMINLOG;

DROP TABLE AdminLog CASCADE CONSTRAINTS;
DROP TABLE Submissions CASCADE CONSTRAINTS;
DROP TABLE Answers CASCADE CONSTRAINTS;
DROP TABLE Questions CASCADE CONSTRAINTS;
DROP TABLE UserQuiz CASCADE CONSTRAINTS;
DROP TABLE Quiz CASCADE CONSTRAINTS;
DROP TABLE Users CASCADE CONSTRAINTS;